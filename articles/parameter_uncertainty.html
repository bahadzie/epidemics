<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="epidemics">
<title>Generating and modelling R uncertainty • epidemics</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generating and modelling R uncertainty">
<meta property="og:description" content="epidemics">
<meta property="og:image" content="https://epiverse.github.io/epidemics/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ471458FQ');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a href="https://epiverse-trace.github.io/" class="external-link"><img src="../logo_white.svg" id="logo" alt="Epiverse-TRACE"></a>
    <a class="navbar-brand me-2" href="../index.html">epidemics</a>

    <small class="nav-text text-muted me-auto version-number" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/epidemics.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Package vignettes</h6>
    <a class="dropdown-item" href="../articles/modelling_vaccination.html">Modelling a vaccination campaign</a>
    <a class="dropdown-item" href="../articles/modelling_interventions.html">Modelling interventions</a>
    <a class="dropdown-item" href="../articles/multiple_interventions.html">Modelling multiple overlapping non-pharmaceutical interventions</a>
    <a class="dropdown-item" href="../articles/rate_interventions.html">Modelling interventions on model rates</a>
    <a class="dropdown-item" href="../articles/time_dependence.html">Modelling time-dependence in epidemic parameters</a>
    <a class="dropdown-item" href="../articles/parameter_uncertainty.html">Generating and modelling R uncertainty</a>
    <a class="dropdown-item" href="../articles/finalsize_comparison.html">When to use ODE models or analytical methods for epidemic size modelling</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Guides to library models</h6>
    <a class="dropdown-item" href="../articles/vacamole.html">Using the RIVM Vacamole model of leaky vaccination and hospitalisations</a>
    <a class="dropdown-item" href="../articles/ebola_model.html">Modelling ebolavirus disease with a stochastic model</a>
    <a class="dropdown-item" href="../articles/benchmarking.html">Benchmarking R and Rcpp implementations of epidemic models</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/epiverse-trace/epidemics/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Generating and modelling R uncertainty</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiverse-trace/epidemics/blob/HEAD/vignettes/parameter_uncertainty.Rmd" class="external-link"><code>vignettes/parameter_uncertainty.Rmd</code></a></small>
      <div class="d-none name"><code>parameter_uncertainty.Rmd</code></div>
    </div>

    
    
<p>Uncertainty in the characteristics of an epidemic is a key element and roadblock in epidemic response <span class="citation">(<a href="#ref-shea2020" role="doc-biblioref">Shea et al. 2020</a>)</span>.
This vignette aims to show how to model parameter uncertainty using <em>epidemics</em>, as well as how it might affect conclusions regarding the implementation of response measures such as non-pharmaceutical interventions.</p>
<div class="alert alert-warning">
<p><strong>New to <em>epidemics</em>?</strong> It may help to read the <a href="epidemics.html">“Get started”</a> vignette first!</p>
</div>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load epidemics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epiverse-trace/epidemics" class="external-link">epidemics</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load CRAN packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mrc-ide/EpiEstim" class="external-link">EpiEstim</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</details><div class="section level2">
<h2 id="prepare-r-estimates">Prepare <span class="math inline">\(R\)</span> estimates<a class="anchor" aria-label="anchor" href="#prepare-r-estimates"></a>
</h2>
<p>For this example, we consider influenza with pandemic potential <span class="citation">(<a href="#ref-ghani2010" role="doc-biblioref">Ghani et al. 2010</a>)</span>, and prepare multiple samples of the estimated <span class="math inline">\(R\)</span>.</p>
<p>We obtain the probability distribution function (PDF) from the distribution of the serial intervals; this is a Gamma distribution with shape <span class="math inline">\(k\)</span> = 2.622 and scale <span class="math inline">\(\theta\)</span> = 0.957 <span class="citation">(<a href="#ref-ghani2010" role="doc-biblioref">Ghani et al. 2010</a>)</span>.</p>
<div class="alert alert-info">
<p>The <a href="https://epiverse-trace.github.io/epiparameter/" class="external-link">forthcoming Epiverse package <em>epiparameter</em></a> is expected to make it substantially easier to access and use epidemiological parameters, such as the serial interval, reported in the literature, making it easier to model scenarios differing in the intrinsic characteristics of the pathogen causing the outbreak.</p>
</div>
<p>We use this PDF to estimate the <span class="math inline">\(R\)</span> of the 2009 influenza pandemic in the U.K., using <a href="https://cran.r-project.org/package=EpiEstim" class="external-link">the <em>EpiEstim</em> package</a>.
We use the <span class="math inline">\(R\)</span> estimate (the mean and standard deviation) from <em>EpiEstim</em> to generate 100 samples of <span class="math inline">\(R\)</span>, assuming that it is normally distributed.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get 2009 influenza data for school in Pennsylvania</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">)</span></span>
<span><span class="va">flu_early_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Flu2009</span><span class="op">$</span><span class="va">incidence</span>, <span class="va">dates</span> <span class="op">&lt;</span> <span class="st">"2009-05-10"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get the PDF of the distribution of serial intervals</span></span>
<span><span class="va">serial_pdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">dgamma</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">2.622</span>, scale <span class="op">=</span> <span class="fl">0.957</span><span class="op">)</span></span>
<span><span class="va">serial_pdf</span> <span class="op">&lt;-</span> <span class="va">serial_pdf</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">serial_pdf</span><span class="op">)</span> <span class="co"># check sum to 1</span></span>
<span></span>
<span><span class="co"># Use EpiEstim to estimate R with uncertainty</span></span>
<span><span class="co"># Uses Gamma distribution by default</span></span>
<span><span class="va">output_R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EpiEstim/man/estimate_R.html" class="external-link">estimate_R</a></span><span class="op">(</span></span>
<span>  incid <span class="op">=</span> <span class="va">flu_early_data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"non_parametric_si"</span>,</span>
<span>  config <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/EpiEstim/man/make_config.html" class="external-link">make_config</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>si_distr <span class="op">=</span> <span class="va">serial_pdf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot output to visualise</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">output_R</span>, <span class="st">"R"</span><span class="op">)</span></span></code></pre></div>
</details><p><img src="parameter_uncertainty_files/figure-html/unnamed-chunk-3-1.png"><!-- --></p>
<p>Generate 100 samples of <span class="math inline">\(R\)</span>.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate 100 R samples</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">r_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">100</span>, mean <span class="op">=</span> <span class="va">output_R</span><span class="op">$</span><span class="va">R</span><span class="op">$</span><span class="va">`Mean(R)`</span>, sd <span class="op">=</span> <span class="va">output_R</span><span class="op">$</span><span class="va">R</span><span class="op">$</span><span class="va">`Std(R)`</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<div class="section level2">
<h2 id="prepare-epidemic-model-inputs">Prepare epidemic model inputs<a class="anchor" aria-label="anchor" href="#prepare-epidemic-model-inputs"></a>
</h2>
<p>We define inputs for the default, SEIR-V model in <em>epidemics</em> in the form of a <code>&lt;population&gt;</code> object.
We omit non-pharmaceutical interventions and vaccinations for this example.</p>
<p>Since this step is identical to that in previous vignettes, the code is folded, but can be expanded for clarity.</p>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load contact and population data from socialmixr::polymod</span></span>
<span><span class="va">polymod</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="va"><a href="https://epiforecasts.io/socialmixr/reference/polymod.html" class="external-link">polymod</a></span></span>
<span><span class="va">contact_data</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="fu"><a href="https://epiforecasts.io/socialmixr/reference/contact_matrix.html" class="external-link">contact_matrix</a></span><span class="op">(</span></span>
<span>  <span class="va">polymod</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"United Kingdom"</span>,</span>
<span>  age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare contact matrix</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">contact_data</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare the demography vector</span></span>
<span><span class="va">demography_vector</span> <span class="op">&lt;-</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">population</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">demography_vector</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># initial conditions: one in every 1 million is infected</span></span>
<span><span class="va">initial_i</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span></span>
<span><span class="va">initial_conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  S <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">initial_i</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="va">initial_i</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build for all age groups</span></span>
<span><span class="va">initial_conditions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">initial_conditions</span>,</span>
<span>  <span class="va">initial_conditions</span>,</span>
<span>  <span class="va">initial_conditions</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">initial_conditions</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare the population to model as affected by the epidemic</span></span>
<span><span class="va">uk_population</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population.html">population</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"UK"</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector</span>,</span>
<span>  initial_conditions <span class="op">=</span> <span class="va">initial_conditions</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># an intervention to close schools</span></span>
<span><span class="va">close_schools</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/intervention.html">intervention</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"contacts"</span>,</span>
<span>  time_begin <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">260</span>,</span>
<span>  reduction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<div class="section level2">
<h2 id="run-with-r-uncertainty">Run with <span class="math inline">\(R\)</span> uncertainty<a class="anchor" aria-label="anchor" href="#run-with-r-uncertainty"></a>
</h2>
<p>Loop over sampled <span class="math inline">\(R\)</span> values to generate epidemic model outputs with uncertainty.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define the infectious period</span></span>
<span><span class="va">infectious_period</span> <span class="op">&lt;-</span> <span class="fl">7</span></span>
<span></span>
<span><span class="co"># iterate over the R samples, running the epidemic model for each value of R</span></span>
<span><span class="va">output_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span></span>
<span>  <span class="va">r_samples</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">r_samples</span><span class="op">)</span>,</span>
<span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># run an epidemic model using `epidemic()`</span></span>
<span>    <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_default.html">model_default_cpp</a></span><span class="op">(</span></span>
<span>      population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>      transmissibility <span class="op">=</span> <span class="va">x</span> <span class="op">/</span> <span class="va">infectious_period</span>,</span>
<span>      recovery_rate <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">infectious_period</span>,</span>
<span>      intervention <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>contacts <span class="op">=</span> <span class="va">close_schools</span><span class="op">)</span>,</span>
<span>      time_end <span class="op">=</span> <span class="fl">600</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># calculate new infections</span></span>
<span>    <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_infections.html">new_infections</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># assign scenario number</span></span>
<span>    <span class="va">output</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"scenario"</span>, <span class="st">"R"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">x</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">output</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p>We view the output of a few scenario runs.</p>
<details class="chunk-details" open><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View the firt few rows of the first two runs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">output_samples</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="va">head</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;    time demography_group new_infections scenario       R</span></span>
<span><span class="co">#&gt; 1:    0              40+       0.000000        1 1.47341</span></span>
<span><span class="co">#&gt; 2:    0           [0,20)       0.000000        1 1.47341</span></span>
<span><span class="co">#&gt; 3:    0          [20,40)       0.000000        1 1.47341</span></span>
<span><span class="co">#&gt; 4:    1              40+       4.488961        1 1.47341</span></span>
<span><span class="co">#&gt; 5:    1           [0,20)       3.516643        1 1.47341</span></span>
<span><span class="co">#&gt; 6:    1          [20,40)       3.414592        1 1.47341</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;    time demography_group new_infections scenario        R</span></span>
<span><span class="co">#&gt; 1:    0              40+       0.000000        2 1.812195</span></span>
<span><span class="co">#&gt; 2:    0           [0,20)       0.000000        2 1.812195</span></span>
<span><span class="co">#&gt; 3:    0          [20,40)       0.000000        2 1.812195</span></span>
<span><span class="co">#&gt; 4:    1              40+       5.538607        2 1.812195</span></span>
<span><span class="co">#&gt; 5:    1           [0,20)       4.341045        2 1.812195</span></span>
<span><span class="co">#&gt; 6:    1          [20,40)       4.213767        2 1.812195</span></span>
<span></span>
<span><span class="co"># combine to prepare for plotting</span></span>
<span><span class="va">output_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">output_samples</span><span class="op">)</span></span></code></pre></div>
</details><p>We obtain the epidemic runs and plot the number of new infections in each scenario; the plotting code is folded for brevity.</p>
<details class="chunk-details"><summary class="chunk-summary"><span class="chunk-summary-text">Code</span></summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">output_samples</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span></span>
<span>    xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">260</span><span class="op">)</span>,</span>
<span>    colour <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"dashed"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>    x <span class="op">=</span> <span class="fl">230</span>, y <span class="op">=</span> <span class="fl">600e3</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"Schools closed"</span>,</span>
<span>    colour <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    angle <span class="op">=</span> <span class="fl">90</span>,</span>
<span>    hjust <span class="op">=</span> <span class="st">"inward"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      <span class="va">time</span>, <span class="va">new_infections</span>,</span>
<span>      group <span class="op">=</span> <span class="va">scenario</span>,</span>
<span>      colour <span class="op">=</span> <span class="va">R</span></span>
<span>    <span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_fermenter</a></span><span class="op">(</span></span>
<span>    palette <span class="op">=</span> <span class="st">"Dark2"</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2.0</span>, <span class="fl">3.0</span><span class="op">)</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"New infections"</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_comma</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">1e-3</span>, suffix <span class="op">=</span> <span class="st">"K"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Time (days since start of epidemic)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">demography_group</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    legend.key.height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</details><div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-8"></span>
<img src="parameter_uncertainty_files/figure-html/unnamed-chunk-8-1.png" alt="Modelling scenarios of the spread of influenza with pandemic potential in the U.K., with uncertainty in the reproduction number $R$. Each scenario represents one of 1,000 runs with different values of $R$ estimated from the case data for the 2009 influenza pandemic in the U.K. Scenarios are coloured by $R$, which is divided into four bins for visual clarity. Values of $R &lt;$ 1.0 do not lead to large epidemics. The duration of a non-pharmaceutical intervention to close schools for two months (affecting the social contacts of all individuals under age 20) is also shown. For example, in high $R$ scenarios (green), school closures have little effect, as the epidemic has peaked before the intervention can take effect; this demonstrates how uncertainty in epidemic characterists may influence the effectiveness of response measures."><p class="caption">
Figure 1: Modelling scenarios of the spread of influenza with pandemic potential in the U.K., with uncertainty in the reproduction number <span class="math inline">\(R\)</span>. Each scenario represents one of 1,000 runs with different values of <span class="math inline">\(R\)</span> estimated from the case data for the 2009 influenza pandemic in the U.K. Scenarios are coloured by <span class="math inline">\(R\)</span>, which is divided into four bins for visual clarity. Values of <span class="math inline">\(R &lt;\)</span> 1.0 do not lead to large epidemics. The duration of a non-pharmaceutical intervention to close schools for two months (affecting the social contacts of all individuals under age 20) is also shown. For example, in high <span class="math inline">\(R\)</span> scenarios (green), school closures have little effect, as the epidemic has peaked before the intervention can take effect; this demonstrates how uncertainty in epidemic characterists may influence the effectiveness of response measures.
</p>
</div>
<p>The <a href="https://epiverse-trace.github.io/scenarios/" class="external-link">forthcoming Epiverse package <em>scenarios</em></a> is expected to include functionality that wraps the iteration step shown in this vignette, to make it easier to model parameter uncertainty.</p>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-ghani2010" class="csl-entry">
Ghani, Azra, Marc Baguelin, Jamie Griffin, Stefan Flasche, Albert Jan Van Hoek, Simon Cauchemez, Christl Donnelly, et al. 2010. <span>“The Early Transmission Dynamics of H1N1pdm Influenza in the United Kingdom.”</span> <em>PLoS Currents</em> 1 (June): RRN1130. <a href="https://doi.org/10.1371/currents.RRN1130" class="external-link">https://doi.org/10.1371/currents.RRN1130</a>.
</div>
<div id="ref-shea2020" class="csl-entry">
Shea, Katriona, Ottar N. Bjørnstad, Martin Krzywinski, and Naomi Altman. 2020. <span>“Uncertainty and the Management of Epidemics.”</span> <em>Nature Methods</em> 17 (9): 867–68. <a href="https://doi.org/10.1038/s41592-020-0943-4" class="external-link">https://doi.org/10.1038/s41592-020-0943-4</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Pratik Gupte, Rosalind Eggo, Edwin Van Leeuwen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
